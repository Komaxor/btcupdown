<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Up/Down â€” CEX Mid Price</title>
  <link rel="stylesheet" href="/css/common.css">
  <link rel="stylesheet" href="/css/updown.css">
</head>
<body>
  <div class="top-nav">
    <a href="/" class="nav-logo">CEX <span>Mid Price</span></a>
    <div class="nav-right">
      <a href="/" class="nav-back">&larr; Home</a>
      <div id="telegramLoginBtn">
        <script async src="https://telegram.org/js/telegram-widget.js?22"
          data-telegram-login="cexmidpricebot"
          data-size="medium"
          data-radius="8"
          data-userpic="false"
          data-onauth="onTelegramAuth(user)"
          data-request-access="write">
        </script>
      </div>
      <div id="userInfo">
        <div id="userInfoTrigger">
          <img id="userAvatar" src="" alt="">
          <span id="userName"></span>
          <span id="userBalanceDisplay"></span>
          <span class="dropdown-arrow">&#9662;</span>
        </div>
        <div id="userDropdown" class="user-dropdown">
          <a href="/profile.html" target="_blank" class="user-dropdown-item">History</a>
          <a href="/api.html" target="_blank" class="user-dropdown-item">API</a>
          <button class="user-dropdown-item" id="logoutBtn">Logout</button>
        </div>
      </div>
    </div>
  </div>
  <div class="main-layout">
    <div class="left-panel">
      <div class="header">
        <div class="btc-logo">â‚¿</div>
        <div class="header-main">
          <div class="header-top">
            <div class="event-title">Bitcoin Up or Down</div>
            <div class="countdown-block">
              <div class="countdown-phase" id="countdownPhase"></div>
              <div class="countdown-unit" id="countdownMinsUnit">
                <div class="countdown-value" id="countdownMins">--</div>
                <div class="countdown-label">Mins</div>
              </div>
              <div class="countdown-unit" id="countdownSecsUnit">
                <div class="countdown-value" id="countdownSecs">--</div>
                <div class="countdown-label">Secs</div>
              </div>
              <div class="countdown-closed" id="countdownClosed" style="display:none;">CLOSED</div>
            </div>
          </div>
          <div class="event-time" id="eventTime">January 22, 3:45-4PM ET</div>
          <div class="price-row">
            <div class="price-block">
              <div class="price-label">Price to Beat</div>
              <div class="price-value beat" id="priceToBeat">$--</div>
            </div>
            <div class="price-block">
              <div class="price-label-with-diff">
                <span class="price-label">Current Price</span>
                <span class="price-diff-small" id="priceDiff"></span>
              </div>
              <div class="price-value current" id="price">$--</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Go to Current Market overlay (shown when viewing closed market) -->
      <div class="go-current-overlay" id="goCurrentOverlay" style="display:none;">
        <div class="go-current-overlay-inner">
          <div class="go-current-overlay-text">This market has closed</div>
          <a class="trade-btn go-current-btn" id="overlayGoCurrentBtn" href="/market/">Go to Current Market</a>
        </div>
      </div>

      <div class="chart-container" id="chartContainer">
        <div class="status">
          <div class="status-dot" id="statusDot"></div>
          <span id="statusText">Connecting...</span>
        </div>
        <div class="y-axis">
          <div class="y-label max" id="maxPrice">--</div>
          <div class="y-label current" id="currentPriceLabel">--</div>
          <div class="y-label min" id="minPrice">--</div>
        </div>
        <div class="chart-wrapper">
          <canvas id="chart"></canvas>
          <div class="tooltip" id="tooltip"></div>
        </div>
        <div class="time-axis" id="timeAxis"></div>
      </div>

      <div class="outcomes-section">
        <div class="outcomes-header">Previous Outcomes</div>
        <div class="outcomes-list" id="outcomesList"></div>
      </div>

      <!-- Open Orders (visible only when user has active orders) -->
      <div class="open-orders-section" id="openOrdersSection" style="display:none;">
        <div class="open-orders-header">
          <span>Open Orders</span>
          <span class="open-orders-count" id="openOrdersCount"></span>
        </div>
        <div class="open-orders-list" id="openOrdersList"></div>
      </div>

      <!-- Order Book -->
      <div class="orderbook-section" id="orderbookSection">
        <div class="orderbook-header">
          <div class="orderbook-title">
            <span>Order Book</span>
            <span class="orderbook-volume" id="orderbookVolume"></span>
          </div>
          <button class="orderbook-collapse-btn" id="orderbookCollapseBtn">&#9662;</button>
        </div>
        <div class="orderbook-body" id="orderbookBody">
          <div class="orderbook-tabs">
            <button class="orderbook-tab active" id="obTabUp">Trade Up</button>
            <button class="orderbook-tab" id="obTabDown">Trade Down</button>
          </div>
          <div class="orderbook-columns">
            <span class="ob-col-label ob-col-depth"></span>
            <span class="ob-col-label ob-col-price">PRICE</span>
            <span class="ob-col-label ob-col-shares">SHARES</span>
            <span class="ob-col-label ob-col-total">TOTAL</span>
          </div>
          <div class="orderbook-asks" id="orderbookAsks"></div>
          <div class="orderbook-spread" id="orderbookSpread">
            <span class="spread-last" id="spreadLast">Last: --</span>
            <span class="spread-value" id="spreadValue">Spread: --</span>
          </div>
          <div class="orderbook-bids" id="orderbookBids"></div>
        </div>
      </div>

      <div class="data-feed" id="dataFeed">
        <div class="data-feed-header">
          <span>Chart Data (1s intervals)</span>
          <span class="ws-status" id="wsStatus">--</span>
        </div>
      </div>
    </div>

    <div class="right-panel">
      <div class="bet-panel">
        <!-- Tabs: Buy / Sell + Order Type Dropdown -->
        <div class="bet-tabs">
          <button class="bet-tab active" id="tabBuy">Buy</button>
          <button class="bet-tab" id="tabSell">Sell</button>
          <div class="bet-order-type">
            <button class="order-type-btn" id="orderTypeBtn">
              <span id="orderTypeLabel">Market</span>
              <span>â–¾</span>
            </button>
            <div class="order-dropdown" id="orderDropdown">
              <div class="order-option selected" data-type="market">Market</div>
              <div class="order-option" data-type="limit">Limit</div>
              <div class="order-option" data-type="stop_limit">Stop Limit</div>
            </div>
          </div>
        </div>

        <!-- Up / Down Outcome Buttons -->
        <div class="outcome-buttons">
          <button class="outcome-btn yes selected" id="btnYes">
            Up <span class="outcome-price" id="yesPrice">50Â¢</span>
          </button>
          <button class="outcome-btn no" id="btnNo">
            Down <span class="outcome-price" id="noPrice">50Â¢</span>
          </button>
        </div>

        <!-- Stop Price (only for Stop Limit orders) -->
        <div class="bet-section stop-section" id="stopSection">
          <div class="bet-label">Stop Price <span class="label-hint">(trigger)</span></div>
          <div class="limit-price-control">
            <button class="limit-btn" id="stopMinus">âˆ’</button>
            <div class="limit-value"><span id="stopValue">50</span>Â¢</div>
            <button class="limit-btn" id="stopPlus">+</button>
          </div>
        </div>

        <!-- Limit Price (for Limit + Stop Limit orders) -->
        <div class="bet-section limit-section" id="limitSection">
          <div class="bet-label">Limit Price</div>
          <div class="limit-price-control">
            <button class="limit-btn" id="limitMinus">âˆ’</button>
            <div class="limit-value"><span id="limitValue">50</span>Â¢</div>
            <button class="limit-btn" id="limitPlus">+</button>
          </div>
        </div>

        <!-- Shares Input -->
        <div class="bet-section">
          <div class="bet-label">Shares</div>
          <div class="shares-input-wrap">
            <input type="number" class="shares-input" id="sharesInput" placeholder="0" value="">
          </div>
          <!-- Quick buttons for Limit orders -->
          <div class="quick-buttons limit-section" id="limitQuickBtns">
            <button class="quick-btn" data-delta="-100">-100</button>
            <button class="quick-btn" data-delta="-10">-10</button>
            <button class="quick-btn" data-delta="10">+10</button>
            <button class="quick-btn" data-delta="100">+100</button>
            <button class="quick-btn accent" data-delta="200">+200</button>
          </div>
          <!-- Quick buttons for Market orders -->
          <div class="quick-buttons market-section show" id="marketQuickBtns">
            <button class="quick-btn" data-pct="25">25%</button>
            <button class="quick-btn" data-pct="50">50%</button>
            <button class="quick-btn" data-pct="100">Max</button>
          </div>
        </div>

        <!-- Expiration Toggle (only for Limit) -->
        <div class="expiry-row limit-section disabled" id="expirySection" title="Coming soon">
          <span class="expiry-label">Set Expiration</span>
          <div class="toggle-switch" id="expiryToggle"></div>
        </div>

        <!-- Summary -->
        <div class="bet-summary">
          <div class="summary-row">
            <span class="summary-label">Total</span>
            <span class="summary-value" id="totalValue">$0</span>
          </div>
          <div class="summary-row to-win-row">
            <span class="summary-label">To win <span class="info-icon">i</span></span>
            <span class="to-win-value">ðŸ’µ <span id="toWinValue">$0</span></span>
          </div>
        </div>

        <button class="trade-btn" id="tradeBtn">Trade</button>
      </div>

      <!-- Liquidity Panel (provision phase) -->
      <div class="liquidity-panel" id="liquidityPanel" style="display:none;">
        <div class="lp-header">Add Liquidity</div>
        <div class="lp-market-info">
          <span class="lp-slug" id="lpSlug"></span>
          <span class="lp-countdown" id="lpCountdown"></span>
        </div>
        <div class="lp-desc">Deposit $X to receive X Up + X Down shares for market making.</div>
        <div class="bet-section">
          <div class="bet-label">Amount ($)</div>
          <div class="shares-input-wrap">
            <input type="number" class="shares-input" id="lpAmountInput" placeholder="0" min="1" step="1">
          </div>
          <div class="quick-buttons show">
            <button class="quick-btn lp-quick" data-amount="10">$10</button>
            <button class="quick-btn lp-quick" data-amount="50">$50</button>
            <button class="quick-btn lp-quick" data-amount="100">$100</button>
          </div>
        </div>
        <div class="lp-position" id="lpPosition" style="display:none;">
          <span class="lp-pos-label">Your Position</span>
          <span class="lp-pos-value" id="lpPosValue"></span>
        </div>
        <button class="trade-btn" id="lpSubmitBtn">Add Liquidity</button>
        <a class="trade-btn go-current-btn" id="lpGoCurrentBtn" href="/market/">Go to Current Market</a>
      </div>

      <!-- Closed Panel -->
      <div class="closed-panel" id="closedPanel" style="display:none;">
        <div class="closed-header">Market Closed</div>
        <div class="closed-info" id="closedInfo">
          <div class="closed-row">
            <span class="closed-label">Price to beat</span>
            <span class="closed-val" id="closedPriceToBeat">--</span>
          </div>
          <div class="closed-row">
            <span class="closed-label">Price at end</span>
            <span class="closed-val" id="closedFinalPrice">--</span>
          </div>
          <div class="closed-row">
            <span class="closed-label">Outcome</span>
            <span class="closed-val closed-outcome-badge" id="closedOutcomeBadge">--</span>
          </div>
        </div>
        <div class="closed-position" id="closedPosition"></div>
        <button class="trade-btn" id="claimBtn" style="display:none;">Claim</button>
        <a class="trade-btn go-current-btn" id="closedGoCurrentBtn" href="/market/">Go to Current Market</a>
      </div>

      <!-- Markets Section -->
      <div class="markets-section" id="marketsSection">
        <div class="markets-header">Upcoming Markets</div>
        <div class="markets-list" id="marketsList"></div>
      </div>
    </div>
  </div>

  <script src="/js/auth.js"></script>
  <script src="/js/updown.js"></script>
</body>
</html>
