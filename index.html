<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CEX Mid Price</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: #06060b;
      min-height: 100vh;
      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
      color: #c8ccd4;
      overflow-x: hidden;
    }

    /* Subtle grid background */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background:
        linear-gradient(rgba(20,120,255,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(20,120,255,0.03) 1px, transparent 1px);
      background-size: 60px 60px;
      pointer-events: none;
      z-index: 0;
    }

    .container {
      position: relative;
      z-index: 1;
      max-width: 860px;
      margin: 0 auto;
      padding: 60px 24px 80px;
    }

    /* ── Nav ── */
    nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 80px;
    }

    .logo {
      font-size: 0.85rem;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #fff;
    }

    .logo span {
      color: #3b82f6;
    }

    nav a {
      color: #475569;
      text-decoration: none;
      font-size: 0.8rem;
      letter-spacing: 1px;
      text-transform: uppercase;
      transition: color 0.2s;
    }

    nav a:hover {
      color: #fff;
    }

    /* ── Hero price ── */
    .hero {
      text-align: center;
      margin-bottom: 100px;
    }

    .hero-label {
      font-size: 0.7rem;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: #475569;
      margin-bottom: 16px;
    }

    .hero-price {
      font-size: 4.5rem;
      font-weight: 700;
      color: #fff;
      letter-spacing: -2px;
      line-height: 1;
      margin-bottom: 12px;
      transition: color 0.3s;
    }

    .hero-price.up { color: #22c55e; }
    .hero-price.down { color: #ef4444; }

    .hero-sub {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      font-size: 0.8rem;
      color: #475569;
    }

    .hero-change {
      font-weight: 600;
      font-size: 0.85rem;
    }

    .hero-change.up { color: #22c55e; }
    .hero-change.down { color: #ef4444; }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(34,197,94,0.08);
      border: 1px solid rgba(34,197,94,0.2);
      border-radius: 100px;
      padding: 4px 12px;
      font-size: 0.7rem;
      color: #22c55e;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .status-pill .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #22c55e;
      animation: blink 2s infinite;
    }

    .status-pill.disconnected {
      background: rgba(239,68,68,0.08);
      border-color: rgba(239,68,68,0.2);
      color: #ef4444;
    }

    .status-pill.disconnected .dot {
      background: #ef4444;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    /* ── Marquee ── */
    .marquee-wrap {
      margin-top: 40px;
      position: relative;
      overflow: hidden;
      width: 100vw;
      left: 50%;
      transform: translateX(-50%);
      border-top: 1px solid rgba(255,255,255,0.04);
      border-bottom: 1px solid rgba(255,255,255,0.04);
      padding: 14px 0;
    }

    .marquee-wrap::before,
    .marquee-wrap::after {
      content: '';
      position: absolute;
      top: 0;
      bottom: 0;
      width: 80px;
      z-index: 2;
      pointer-events: none;
    }

    .marquee-wrap::before {
      left: 0;
      background: linear-gradient(90deg, #06060b, transparent);
    }

    .marquee-wrap::after {
      right: 0;
      background: linear-gradient(-90deg, #06060b, transparent);
    }

    .marquee-label {
      position: absolute;
      left: 50%;
      top: -10px;
      transform: translateX(-50%);
      background: #06060b;
      padding: 0 12px;
      font-size: 0.6rem;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #334155;
      z-index: 3;
    }

    .marquee-track {
      display: flex;
      align-items: center;
      gap: 48px;
      width: max-content;
      animation: scroll 30s linear infinite;
    }

    .marquee-track:hover {
      animation-play-state: paused;
    }

    @keyframes scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    .marquee-item {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0;
      opacity: 0.5;
      transition: opacity 0.3s;
    }

    .marquee-item:hover {
      opacity: 1;
    }

    .marquee-logo {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.7rem;
      color: #fff;
      flex-shrink: 0;
    }

    .marquee-logo.binance { background: #f0b90b; color: #000; }
    .marquee-logo.coinbase { background: #0052ff; }
    .marquee-logo.bybit { background: #f7a600; color: #000; }
    .marquee-logo.kraken { background: #7b61ff; }
    .marquee-logo.kucoin { background: #23af91; }
    .marquee-logo.gemini { background: #00dcfa; color: #000; }

    .marquee-name {
      font-size: 0.8rem;
      color: #94a3b8;
      letter-spacing: 0.5px;
      white-space: nowrap;
    }

    /* ── Sections ── */
    .section {
      margin-bottom: 80px;
    }

    .section-label {
      font-size: 0.65rem;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: #3b82f6;
      margin-bottom: 20px;
    }

    .section h2 {
      font-size: 1.6rem;
      font-weight: 600;
      color: #e2e8f0;
      line-height: 1.4;
      margin-bottom: 20px;
      font-family: 'SF Pro Display', 'Inter', 'Segoe UI', system-ui, sans-serif;
    }

    .section p {
      font-size: 0.9rem;
      line-height: 1.8;
      color: #64748b;
      max-width: 640px;
      font-family: 'SF Pro Text', 'Inter', 'Segoe UI', system-ui, sans-serif;
    }

    /* ── Method grid ── */
    .method-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 12px;
      overflow: hidden;
      margin-top: 32px;
    }

    .method-cell {
      background: #0a0a10;
      padding: 28px 24px;
    }

    .method-cell .num {
      font-size: 0.7rem;
      color: #3b82f6;
      letter-spacing: 2px;
      margin-bottom: 12px;
    }

    .method-cell h3 {
      font-size: 0.95rem;
      color: #e2e8f0;
      font-weight: 600;
      margin-bottom: 8px;
      font-family: 'SF Pro Display', 'Inter', 'Segoe UI', system-ui, sans-serif;
    }

    .method-cell p {
      font-size: 0.8rem;
      line-height: 1.6;
      color: #475569;
      font-family: 'SF Pro Text', 'Inter', 'Segoe UI', system-ui, sans-serif;
    }

    /* ── Weights table ── */
    .weights-table {
      margin-top: 32px;
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 12px;
      overflow: hidden;
    }

    .weights-row {
      display: flex;
      align-items: center;
      padding: 14px 24px;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      transition: background 0.2s;
    }

    .weights-row:last-child {
      border-bottom: none;
    }

    .weights-row:hover {
      background: rgba(255,255,255,0.02);
    }

    .weights-row.header {
      background: rgba(255,255,255,0.02);
    }

    .weights-row.header span {
      font-size: 0.65rem;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #475569;
    }

    .w-exchange {
      flex: 1;
      font-size: 0.85rem;
      color: #e2e8f0;
    }

    .w-pair {
      width: 120px;
      font-size: 0.8rem;
      color: #64748b;
    }

    .w-weight {
      width: 80px;
      text-align: right;
      font-size: 0.85rem;
      font-weight: 600;
      color: #3b82f6;
    }

    .w-bar-wrap {
      width: 100px;
      margin-left: 16px;
    }

    .w-bar {
      height: 4px;
      border-radius: 2px;
      background: rgba(59,130,246,0.3);
    }

    /* ── Use cases ── */
    .use-cases {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      margin-top: 32px;
    }

    .use-case {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      padding: 24px;
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.05);
      border-radius: 10px;
      transition: border-color 0.2s;
    }

    .use-case:hover {
      border-color: rgba(59,130,246,0.2);
    }

    .use-case-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      background: rgba(59,130,246,0.08);
      border: 1px solid rgba(59,130,246,0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      flex-shrink: 0;
    }

    .use-case h3 {
      font-size: 0.9rem;
      color: #e2e8f0;
      font-weight: 600;
      margin-bottom: 6px;
      font-family: 'SF Pro Display', 'Inter', 'Segoe UI', system-ui, sans-serif;
    }

    .use-case p {
      font-size: 0.8rem;
      line-height: 1.6;
      color: #475569;
      font-family: 'SF Pro Text', 'Inter', 'Segoe UI', system-ui, sans-serif;
    }

    /* ── CTA ── */
    .cta-section {
      text-align: center;
      padding: 60px 0;
      border-top: 1px solid rgba(255,255,255,0.04);
    }

    .cta-section h2 {
      font-size: 1.4rem;
      color: #e2e8f0;
      font-weight: 600;
      margin-bottom: 12px;
      font-family: 'SF Pro Display', 'Inter', 'Segoe UI', system-ui, sans-serif;
    }

    .cta-section p {
      font-size: 0.85rem;
      color: #475569;
      margin-bottom: 28px;
      font-family: 'SF Pro Text', 'Inter', 'Segoe UI', system-ui, sans-serif;
    }

    .cta-btn {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 14px 32px;
      background: #3b82f6;
      color: #fff;
      text-decoration: none;
      font-size: 0.85rem;
      font-weight: 600;
      letter-spacing: 0.5px;
      border-radius: 8px;
      transition: all 0.2s;
      font-family: 'SF Pro Text', 'Inter', 'Segoe UI', system-ui, sans-serif;
    }

    .cta-btn:hover {
      background: #2563eb;
      transform: translateY(-1px);
      box-shadow: 0 8px 30px rgba(59,130,246,0.25);
    }

    .cta-btn .arrow {
      transition: transform 0.2s;
    }

    .cta-btn:hover .arrow {
      transform: translateX(3px);
    }

    /* ── Footer ── */
    footer {
      text-align: center;
      padding: 40px 0;
      font-size: 0.7rem;
      color: #1e293b;
      letter-spacing: 1px;
    }

    /* ── Responsive ── */
    @media (max-width: 640px) {
      .container { padding: 40px 16px 60px; }
      .hero { margin-bottom: 60px; }
      .hero-price { font-size: 3rem; }
      .method-grid { grid-template-columns: 1fr; }
      .source-bar { gap: 12px; }
      .w-bar-wrap { display: none; }
    }
  </style>
</head>
<body>
  <div class="container">

    <nav>
      <div class="logo">CEX <span>Mid Price</span></div>
      <a href="updown.html">Up/Down</a>
    </nav>

    <!-- Hero Price -->
    <div class="hero">
      <div class="hero-label">BTC Aggregated Mid Price</div>
      <div class="hero-price" id="price">$--</div>
      <div class="hero-sub">
        <span class="hero-change" id="change"></span>
        <span class="status-pill disconnected" id="statusPill">
          <span class="dot"></span>
          <span id="statusLabel">Connecting</span>
        </span>
        <span id="sourceCount"></span>
      </div>
    </div>

    <div class="marquee-wrap">
      <div class="marquee-label">Powered by</div>
      <div class="marquee-track" id="marqueeTrack">
        <div class="marquee-item"><div class="marquee-logo binance">B</div><span class="marquee-name">Binance</span></div>
        <div class="marquee-item"><div class="marquee-logo coinbase">C</div><span class="marquee-name">Coinbase</span></div>
        <div class="marquee-item"><div class="marquee-logo bybit">By</div><span class="marquee-name">Bybit</span></div>
        <div class="marquee-item"><div class="marquee-logo kraken">K</div><span class="marquee-name">Kraken</span></div>
        <div class="marquee-item"><div class="marquee-logo kucoin">Ku</div><span class="marquee-name">KuCoin</span></div>
        <div class="marquee-item"><div class="marquee-logo gemini">G</div><span class="marquee-name">Gemini</span></div>
        <!-- Duplicate for seamless loop -->
        <div class="marquee-item"><div class="marquee-logo binance">B</div><span class="marquee-name">Binance</span></div>
        <div class="marquee-item"><div class="marquee-logo coinbase">C</div><span class="marquee-name">Coinbase</span></div>
        <div class="marquee-item"><div class="marquee-logo bybit">By</div><span class="marquee-name">Bybit</span></div>
        <div class="marquee-item"><div class="marquee-logo kraken">K</div><span class="marquee-name">Kraken</span></div>
        <div class="marquee-item"><div class="marquee-logo kucoin">Ku</div><span class="marquee-name">KuCoin</span></div>
        <div class="marquee-item"><div class="marquee-logo gemini">G</div><span class="marquee-name">Gemini</span></div>
      </div>
    </div>

    <!-- How it works -->
    <div class="section">
      <div class="section-label">Methodology</div>
      <h2>How the mid price is calculated</h2>
      <p>
        We aggregate real-time BTC prices from 6 major centralized exchanges across
        8 trading pairs. Each source is assigned a weight based on exchange volume
        and liquidity. The result is a single, robust reference price updated every second.
      </p>

      <div class="method-grid">
        <div class="method-cell">
          <div class="num">01</div>
          <h3>Ingest</h3>
          <p>WebSocket connections stream live trade data from Binance, Coinbase, Bybit, Kraken, KuCoin, and Gemini simultaneously.</p>
        </div>
        <div class="method-cell">
          <div class="num">02</div>
          <h3>Normalize</h3>
          <p>Prices from USD, USDT, and USDC pairs are treated equivalently and combined into a unified price set.</p>
        </div>
        <div class="method-cell">
          <div class="num">03</div>
          <h3>Weight</h3>
          <p>Each source is weighted proportionally to its exchange's global trade volume and reliability.</p>
        </div>
        <div class="method-cell">
          <div class="num">04</div>
          <h3>Aggregate</h3>
          <p>A normalized weighted average is computed every second: <code style="color:#3b82f6;font-size:0.75rem">price = &Sigma;(p&times;w) / &Sigma;(w)</code>. If a source drops, remaining weights re-normalize automatically.</p>
        </div>
      </div>
    </div>

    <!-- Weights -->
    <div class="section">
      <div class="section-label">Source Weights</div>
      <h2>Exchange breakdown</h2>
      <p>Weights reflect relative trading volume and market share. Binance dominates global BTC volume and receives the highest weight.</p>

      <div class="weights-table">
        <div class="weights-row header">
          <span class="w-exchange">Exchange</span>
          <span class="w-pair">Pair</span>
          <span class="w-weight">Weight</span>
          <span class="w-bar-wrap"></span>
        </div>
        <div class="weights-row">
          <span class="w-exchange">Binance</span>
          <span class="w-pair">BTC/USDT</span>
          <span class="w-weight">25%</span>
          <span class="w-bar-wrap"><div class="w-bar" style="width:100%"></div></span>
        </div>
        <div class="weights-row">
          <span class="w-exchange">Coinbase</span>
          <span class="w-pair">BTC/USD</span>
          <span class="w-weight">15%</span>
          <span class="w-bar-wrap"><div class="w-bar" style="width:60%"></div></span>
        </div>
        <div class="weights-row">
          <span class="w-exchange">Bybit</span>
          <span class="w-pair">BTC/USDT</span>
          <span class="w-weight">15%</span>
          <span class="w-bar-wrap"><div class="w-bar" style="width:60%"></div></span>
        </div>
        <div class="weights-row">
          <span class="w-exchange">Bybit</span>
          <span class="w-pair">BTC/USDC</span>
          <span class="w-weight">10%</span>
          <span class="w-bar-wrap"><div class="w-bar" style="width:40%"></div></span>
        </div>
        <div class="weights-row">
          <span class="w-exchange">Kraken</span>
          <span class="w-pair">BTC/USDT</span>
          <span class="w-weight">10%</span>
          <span class="w-bar-wrap"><div class="w-bar" style="width:40%"></div></span>
        </div>
        <div class="weights-row">
          <span class="w-exchange">KuCoin</span>
          <span class="w-pair">BTC/USDT</span>
          <span class="w-weight">10%</span>
          <span class="w-bar-wrap"><div class="w-bar" style="width:40%"></div></span>
        </div>
        <div class="weights-row">
          <span class="w-exchange">Gemini</span>
          <span class="w-pair">BTC/USD</span>
          <span class="w-weight">10%</span>
          <span class="w-bar-wrap"><div class="w-bar" style="width:40%"></div></span>
        </div>
        <div class="weights-row">
          <span class="w-exchange">Kraken</span>
          <span class="w-pair">BTC/USDC</span>
          <span class="w-weight">5%</span>
          <span class="w-bar-wrap"><div class="w-bar" style="width:20%"></div></span>
        </div>
      </div>
    </div>

    <!-- Use Cases -->
    <div class="section">
      <div class="section-label">Applications</div>
      <h2>Use cases</h2>
      <p>A reliable, exchange-neutral reference price is foundational infrastructure for the next generation of financial products.</p>

      <div class="use-cases">
        <div class="use-case">
          <div class="use-case-icon">&#8693;</div>
          <div>
            <h3>Binary Options & Prediction Markets</h3>
            <p>Power "up or down" style markets that need a tamper-resistant settlement price not controlled by any single exchange.</p>
          </div>
        </div>
        <div class="use-case">
          <div class="use-case-icon">&#9878;</div>
          <div>
            <h3>Derivatives Settlement</h3>
            <p>Settle perpetual futures, options contracts, and structured products against a fair mid-market reference to prevent manipulation.</p>
          </div>
        </div>
        <div class="use-case">
          <div class="use-case-icon">&#9881;</div>
          <div>
            <h3>DeFi Oracle Feed</h3>
            <p>Serve as the off-chain data source for on-chain oracles, providing smart contracts with reliable, multi-source pricing.</p>
          </div>
        </div>
        <div class="use-case">
          <div class="use-case-icon">&#8644;</div>
          <div>
            <h3>Arbitrage Detection</h3>
            <p>Compare individual exchange prices against the consensus mid to identify spreads and arbitrage opportunities in real time.</p>
          </div>
        </div>
        <div class="use-case">
          <div class="use-case-icon">&#9632;</div>
          <div>
            <h3>Portfolio Valuation</h3>
            <p>Mark-to-market BTC holdings using a single neutral price rather than depending on one exchange's potentially stale or skewed book.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- CTA -->
    <div class="cta-section">
      <h2>Try the live Up/Down market</h2>
      <p>Watch the aggregated price in real time and place simulated bets on whether BTC will be higher or lower at the next minute mark.</p>
      <a href="updown.html" class="cta-btn">
        Open Up/Down <span class="arrow">&rarr;</span>
      </a>
    </div>

    <footer>CEX MID PRICE &middot; REAL-TIME AGGREGATED BTC REFERENCE</footer>
  </div>

  <script>
    const priceEl = document.getElementById('price');
    const changeEl = document.getElementById('change');
    const statusPill = document.getElementById('statusPill');
    const statusLabel = document.getElementById('statusLabel');
    const sourceCount = document.getElementById('sourceCount');

    let lastPrice = null;
    let firstPrice = null;

    function formatPrice(p) {
      return parseFloat(p).toLocaleString('en-US', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    function connect() {
      const ws = new WebSocket('ws://localhost:8080');

      ws.onopen = () => {
        statusPill.classList.remove('disconnected');
        statusLabel.textContent = 'Live';
      };

      ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        const price = parseFloat(data.p);

        if (firstPrice === null) firstPrice = price;

        const dir = lastPrice !== null ? (price >= lastPrice ? 'up' : 'down') : '';
        priceEl.textContent = '$' + formatPrice(price);
        priceEl.className = 'hero-price' + (dir ? ' ' + dir : '');

        // Show change from session start
        if (firstPrice !== null) {
          const diff = price - firstPrice;
          const pct = ((diff / firstPrice) * 100).toFixed(3);
          const sign = diff >= 0 ? '+' : '';
          const cls = diff >= 0 ? 'up' : 'down';
          changeEl.textContent = sign + '$' + Math.abs(diff).toFixed(2) + ' (' + sign + pct + '%)';
          changeEl.className = 'hero-change ' + cls;
        }

        if (data.sources) {
          sourceCount.textContent = data.sources + ' sources';
        }

        lastPrice = price;
      };

      ws.onclose = () => {
        statusPill.classList.add('disconnected');
        statusLabel.textContent = 'Reconnecting';
        setTimeout(connect, 2000);
      };

      ws.onerror = () => ws.close();
    }

    connect();
  </script>
</body>
</html>
